<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>My Love for You</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Great+Vibes&display=swap');

  body {
    margin: 0;
    height: 100vh;
    background: linear-gradient(to bottom right, #ffafbd, #ffc3a0);
    display: flex;
    justify-content: center;
    align-items: center;
    font-family:'Courier New', Courier, monospace;
    color: #fff;
    flex-direction: column;
    overflow: hidden;
    position: relative;
  }

  h1, h2 {
    margin: 0.2em 0;
    text-align: center;
    transition: opacity 2s;
    z-index: 2;
    position: relative;
  }

  h1 {
    font-size: 3em;
  }

  h2 {
    font-size: 2em;
    opacity: 0;
  }

  canvas {
    background: rgba(0,0,0,0.2);
    border-radius: 10px;
    margin-top: 2em;
    box-shadow: 0 0 20px rgba(255, 0, 0, 0.6);
    z-index: 2;
    position: relative;
  }

  .heart {
    position: absolute;
    color: rgba(255, 0, 0, 0.6);
    font-size: 20px;
    animation: floatUp 6s linear infinite;
  }

  @keyframes floatUp {
    0% { transform: translateY(100vh) scale(0.5); opacity: 1; }
    100% { transform: translateY(-10vh) scale(1.2); opacity: 0; }
  }
</style>
</head>
<body>

<h1>How long will I love you?</h1>
<h2 id="fadeText">Until my heartbeat becomes straight...</h2>
<canvas id="heartbeat" width="800" height="200"></canvas>

<script>
const canvas = document.getElementById('heartbeat');
const ctx = canvas.getContext('2d');
const fadeText = document.getElementById('fadeText');

const width = canvas.width;
const height = canvas.height;
let time = 0;
let heartbeatActive = true;

// Smooth ECG wave with spikes
function ecgWave(x) {
    const beat = Math.sin(x * 0.04);
    const spike = Math.exp(-Math.pow((x % 150 - 75)/10, 2)) * 2;
    return beat + spike;
}

// Variable heartbeat speed
function heartbeatSpeed(frame) {
    return 1 + 0.02 * Math.sin(frame * 0.05) + 0.01 * Math.random();
}

function draw() {
    ctx.fillStyle = 'rgba(0,0,0,0.2)';
    ctx.fillRect(0, 0, width, height);

    ctx.strokeStyle = 'red';
    ctx.shadowColor = 'rgba(255,0,0,0.8)';
    ctx.shadowBlur = heartbeatActive ? 20 : 0;
    ctx.lineWidth = 2;

    ctx.beginPath();
    ctx.moveTo(0, height/2);

    for(let i = 0; i < width; i++){
        let y;
        if(heartbeatActive){
            y = height/2 - ecgWave(i + time) * 40;
        } else {
            y = height/2; // Flatline
        }
        ctx.lineTo(i, y);
    }
    ctx.stroke();
}

function animate(){
    time += heartbeatSpeed(time) * 2;

    // Instant flatline
    if(time > 1400 && heartbeatActive){
        heartbeatActive = false;
        fadeText.style.opacity = 1; // reveal text at flatline
    }

    draw();
    requestAnimationFrame(animate);
}

animate();

// Floating heart particles
function createHeart() {
    const heart = document.createElement("div");
    heart.classList.add("heart");
    heart.innerHTML = "❤️";
    heart.style.left = Math.random() * 100 + "vw";
    heart.style.fontSize = Math.random() * 20 + 20 + "px";
    heart.style.animationDuration = 4 + Math.random() * 4 + "s";
    document.body.appendChild(heart);

    setTimeout(() => {
        heart.remove();
    }, 8000);
}

setInterval(createHeart, 800);
</script>

</body>
</html>
